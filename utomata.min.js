function utomata(e,n,t){var a,r,o,c,l,u,s,i,f,v,d={width:e,height:n,transition:"V = vec4(0.0, 0.0, 0.0, 1.0);",config:"vec4(0.0, 0.0, 0.0, 1.0)",doConfig:1,edge:"REPEAT",fps:60,zoom:1,step:0,elapsedTime:0,startTime:Date.now(),mouseDown:0,mouseOver:0,mouseX:0,mouseY:0,pMouseX:0,pMouseY:0,mouseScl:1,randSeed:123.01234,useCastInt:!0,input:void 0,useInput:!1,avgFps:60,stepLimit:-1,completionCallback:void 0,functions:"",alpha:"1.0",tileColumns:1,tileRows:1},b={},m=[],p="",E="",g=void 0,h=void 0,x=!0,T=1e3/d.fps,R=Date.now(),_=null,w=void 0,y="mainCanvas";function U(){try{var e=r.createProgram(),n=X()+d.transition+"\n    ;\n\n    update.a = max("+d.alpha+" , update.a);\n    update = (doConfig * setup) + ((1.0-doConfig) * update);\n\n    gl_FragColor = update;\n    }\n    ",t=P("attribute vec3 position; void main() { gl_Position = vec4( position, 1.0 ); }",r.VERTEX_SHADER),a=P(n,r.FRAGMENT_SHADER)}catch{console.error("cannot create shader")}if(null===t||null===a)return null;if(r.attachShader(e,t),r.attachShader(e,a),r.deleteShader(t),r.deleteShader(a),r.linkProgram(e),r.getProgramParameter(e,r.LINK_STATUS)){c=e,A(e,"time"),A(e,"mouse"),A(e,"pmouse"),A(e,"mouseDown"),A(e,"resolution"),A(e,"tiles"),A(e,"backbuffer"),A(e,"doConfig"),A(e,"randSeed");for(var u=0;u<Object.keys(b).length;u++)A(e,Object.keys(b)[u]);r.useProgram(c),r.bindBuffer(r.ARRAY_BUFFER,o),r.vertexAttribPointer(l,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(l),d.step=0}}function A(e,n){void 0===e.uniformsCache&&(e.uniformsCache={}),e.uniformsCache[n]=r.getUniformLocation(e,n)}function F(e,n){var t={};return t.framebuffer=r.createFramebuffer(),t.renderbuffer=r.createRenderbuffer(),t.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,t.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,n,0,r.RGBA,r.UNSIGNED_BYTE,null),"REPEAT"===d.edge&&S()?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,t.framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t.texture,0),r.bindRenderbuffer(r.RENDERBUFFER,t.renderbuffer),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,e,n),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,t.renderbuffer),r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),t}function C(e){d.input=e,d.input.onload=function(){var e=this.width,n=this.height;d.width=e,d.height=n,a.width=d.width,a.height=d.height,d.width=a.width,d.height=a.height,O(),D(),d.step=0}}function D(){var e={};e.framebuffer=r.createFramebuffer(),e.renderbuffer=r.createRenderbuffer(),e.texture=r.createTexture(),r.viewport(0,0,a.width,a.height),r.bindTexture(r.TEXTURE_2D,e.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,d.input),"REPEAT"===d.edge&&S()?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,e.framebuffer),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e.texture,0),r.bindRenderbuffer(r.RENDERBUFFER,e.renderbuffer),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT16,d.width,d.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,e.renderbuffer),r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),s=e,u=F(d.width,d.height)}function S(){return 0==(d.width&d.width-1)&&0==(d.width&d.width-1)}function P(e,n){for(var t,a,o,c,l,u=r.createShader(n),s=0,i=X().split("\n").length-1;m.length>0;)t=m.pop();if(r.shaderSource(u,e),r.compileShader(u),!r.getShaderParameter(u,r.COMPILE_STATUS)){for(var f=r.getShaderInfoLog(u);f.length>1&&f.charCodeAt(f.length-1)<32;)console.error(f),p=f,f=f.substring(0,f.length-1);for(m=[];s>=0&&!((s=f.indexOf("ERROR: 0:",s))<0);)s+=9,(c=f.indexOf(":",s))>s&&(a=parseInt(f.substring(s,c))-i,!isNaN(a)&&a>0&&(s=c+1,c=f.indexOf("ERROR: 0:",s),l=c>s?f.substring(s,c):f.substring(s),o=String(l).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),m.push(t),m.push("ERROR in Line "+a+" >> "+o)));return null}return u}function I(){a.width=d.width,a.height=d.height,O(),d.width=a.width,d.height=a.height,r.viewport(0,0,a.width,a.height),u=F(d.width,d.height),s=F(d.width,d.height),d.step=0,d.doConfig=1}function O(){a.style.width=d.width*d.zoom+"px",a.style.height=d.height*d.zoom+"px"}function N(){if(c){d.elapsedTime=Date.now()-d.startTime,d.randSeed=Math.random(),r.useProgram(c),r.uniform1f(c.uniformsCache.time,d.step),r.uniform2f(c.uniformsCache.mouse,d.mouseX,d.mouseY),r.uniform2f(c.uniformsCache.pmouse,d.pMouseX,d.pMouseY),r.uniform2f(c.uniformsCache.resolution,d.width,d.height),r.uniform2f(c.uniformsCache.tiles,d.tileColumns,d.tileRows),r.uniform1i(c.uniformsCache.backbuffer,0),r.uniform1f(c.uniformsCache.doConfig,d.doConfig),r.uniform1f(c.uniformsCache.mouseDown,d.mouseDown),r.uniform1f(c.uniformsCache.randSeed,d.randSeed);for(var e=0;e<Object.keys(b).length;e++)r.uniform1f(c.uniformsCache[Object.keys(b)[e]],b[Object.keys(b)[e]]);r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,s.texture),r.bindFramebuffer(r.FRAMEBUFFER,u.framebuffer),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.drawArrays(r.TRIANGLES,0,6),r.useProgram(i),r.uniform2f(i.uniformsCache.resolution,d.width,d.height),r.uniform1i(i.uniformsCache.texture,1),r.activeTexture(r.TEXTURE1),r.bindTexture(r.TEXTURE_2D,u.texture),r.bindFramebuffer(r.FRAMEBUFFER,null),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.drawArrays(r.TRIANGLES,0,6);var n=u;u=s,s=n,d.doConfig=0,void 0!==g&&(g.innerHTML=d.step),void 0!==h&&(x?0===m.length?h.innerHTML="<span style='color:green'>Running at: "+d.avgFps+" fps</span>":E!==p&&(h.innerHTML="<span style='color:red'>"+p+"</span>",E=p):h.innerHTML="Paused"),d.step+=1}}function L(e){if(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/max\s*\(/g,"mx(")).replace(/min\s*\(/g,"mn(")).replace(/mod\s*\(/g,"md(")).replace(/log\s*\(/g,"lg(")).replace(/pow\s*\(/g,"pw(")).replace(/dot\s*\(/g,"dt(")).replace(/sin\s*\(/g,"sn(")).replace(/cos\s*\(/g,"cs(")).replace(/tan\s*\(/g,"tn("),d.useCastInt){var n=new RegExp(/(^|\s|\(|\)|,|;)([0-9]+)(\s|\(|\)|,|;|$)/gm);e=e.replace(n,"$1$2.0$3")}var t=new RegExp(/update\s*=/);return-1===e.search(t)&&(e="update=vec("+e+")"),e}function M(e){var n=a.toDataURL("image/png");switch(e){case"obj":var t=new Image;return t.src=n,t;case"window":window.open(n,"Canvas Image");break;case"download":n=n.replace("image/png","image/octet-stream"),document.location.href=n}}function X(){for(var e="\n    //////////////////////////////////////////\n    //\n    // ETCETERA\n    //\n    //////////////////////////////////////////\n\n    #define PI 3.14159265358979323846\n    #define E 2.71828182845904523536\n    #define G 1.61803398874989484820\n    #define SQ2 1.41421356237309504880\n\n    #ifdef GL_ES\n    precision highp float;\n    #endif\n\n    uniform float time;\n    uniform vec2 mouse;\n    uniform vec2 pmouse;\n    uniform vec2 resolution;\n    uniform vec2 tiles;\n    uniform sampler2D backbuffer;\n\n    uniform float doConfig;\n    uniform float mouseDown;\n    uniform float randSeed;\n\n    ",n=0;n<Object.keys(b).length;n++)e+="uniform float "+Object.keys(b)[n]+";\n";return e+="\n\n    // UTO functions\n\n\n    // VEC //\n\n\n    vec4 vec( float a){return vec4(a);}\n    vec4 vec( float a, float b){return vec4(a, a, a, b);}\n    vec4 vec( float a, float b, float c){return vec4(a, b, c, 1.0);}\n    vec4 vec( float a, float b, float c, float d){return vec4(a, b, c, d);}\n    vec4 vec( vec2 a){return vec4(a.x, a.x, a.x, a.y);}\n    vec4 vec( vec3 a){return vec4(a.x, a.y, a.z, 1.0);}\n    vec4 vec( vec4 a){return a;}\n\n\n    //  BINARY  //\n\n    // ADDITION\n    float add(float a, float b){return a + b;}\n    vec4 add(vec4 a, vec4 b){return a + b;}\n    vec4 add(float a, vec4 b){return vec4(a) + b;}\n    vec4 add(vec4 a, float b){return a + vec4(b);}\n    vec2 add(vec2 a, vec2 b){return a + b;}\n    vec3 add(vec3 a, vec3 b){return a + b;}\n    float add(float a){return a;}\n    vec4 add(vec4 a){return a;}\n\n\n    // SUBTRACTION\n    float sub(float a, float b){return a - b;}\n    vec2 sub(vec2 a, vec2 b){return a - b;}\n    vec3 sub(vec3 a, vec3 b){return a - b;}\n    vec4 sub(vec4 a, vec4 b){return a - b;}\n    vec4 sub(float a, vec4 b){return vec4(a) - b;}\n    vec4 sub(vec4 a, float b){return a - vec4(b);}\n    vec4 sub(vec4 a){return a;}\n    float sub(float a){return a;}\n\n    // MULTIPLICATION\n    vec4 mlt(vec4 a, vec4 b){return a * b;}\n    float mlt(float a, float b){return a * b;}\n    vec4 mlt(float a, vec4 b){return vec4(a) * b;}\n    vec4 mlt(vec4 a, float b){return a * vec4(b);}\n    vec2 mlt(vec2 a, vec2 b){return a * b;}\n    vec3 mlt(vec3 a, vec3 b){return a * b;}\n    vec4 mlt(vec4 a){return a;}\n    float mlt(float a){return a;}\n\n    // DIVISION\n    vec4 div(vec4 a, vec4 b){return a / b;}\n    float div(float a, float b){return a / b;}\n    vec4 div(float a, vec4 b){return vec4(a) / b;}\n    vec4 div(vec4 a, float b){return a / vec4(b);}\n    vec2 div(vec2 a, vec2 b){return a / b;}\n    vec3 div(vec3 a, vec3 b){return a / b;}\n    vec4 div(vec4 a){return a;}\n    float div(float a){return a;}\n\n    // EXPONENTIATION\n    vec4 pw(vec4 a, vec4 b){return pow(a, b);}\n    float pw(float a, float b){return pow(a, b);}\n    vec4 pw(float a, vec4 b){return pow(vec4(a), b);}\n    vec4 pw(vec4 a, float b){return pow(a, vec4(b));}\n    vec2 pw(vec2 a, vec2 b){return pow(a, b);}\n    vec2 pw(vec2 a, float b){return pow(a, vec2(b));}\n    vec3 pw(vec3 a, vec3 b){return pow(a, b);}\n    vec3 pw(vec3 a, float b){return pow(a, vec3(b));}\n    vec4 pw(vec4 a){return a;}\n    float pw(float a){return a;}\n\n    // MODULO\n    float md(float a){return 0.0;}\n    float md(float a, float b){return mod(a, b);}\n    vec2 md(vec2 a, vec2 b){return mod(a, b);}\n    vec2 md(vec2 a, float b){return mod(a, b);}\n    vec3 md(vec3 a, vec3 b){return mod(a, b);}\n    vec3 md(vec3 a, float b){return mod(a, b);}\n    vec4 md(float a, vec4 b){return mod(vec4(a), b);}\n    vec4 md(vec4 a, vec4 b){return mod(a, b);}\n    vec4 md(vec4 a, float b){return mod(a, vec4(b));}\n    vec4 md(vec4 a){return vec4(0.0);}\n\n    // STEP\n    vec4 stp(vec4 a, vec4 b){return step(a,b);}\n    float stp(float a, float b){return step(a,b);}\n    vec4 stp(float a, vec4 b){return step(vec4(a), b);}\n    vec4 stp(vec4 a, float b){return step(a, vec4(b));}\n    vec4 stp(vec4 a){return vec4(1.0);}\n    float stp(float a){return 1.0;}\n\n    // DISTANCE\n    float dst(float a){return a;}\n    float dst(vec2 a){return length(a);}\n    float dst(vec3 a){return length(a);}\n    float dst(vec4 a){return length(a);}\n    float dst(vec2 a, vec2 b){return distance(a,b);}\n    float dst(vec3 a, vec3 b){return distance(a,b);}\n    float dst(vec4 a, vec4 b){return distance(a,b);}\n    float dst(float a, float b){return distance(a,b);}\n    float dst(float a, vec4 b){return distance(vec4(a), b);}\n    float dst(vec4 a, float b){return distance(a, vec4(b));}\n\n    // EQUALITY\n    vec4 eql(vec4 a, vec4 b){return stp(a,b) * stp(b,a);}\n    float eql(float a, float b){return stp(a,b) * stp(b,a);}\n    vec4 eql(vec4 a, float b){return stp(a,vec4(b)) * stp(vec4(b),a);}\n    vec4 eql(float a, vec4 b){return stp(vec4(a),b) * stp(b,vec4(a));}\n    vec4 eql(vec4 a){return vec4(1.0);}\n    float eql(float a){return 1.0;}\n\n\n    // INEQUALITY\n    vec4 not(vec4 a, vec4 b){return vec4(1.0) - (stp(a,b) * stp(b,a));}\n    float not(float a, float b){return 1.0 - (stp(a,b) * stp(b,a));}\n    vec4 not(vec4 a, float b){return vec4(1.0) - (stp(a,vec4(b)) * stp(vec4(b),a));}\n    vec4 not(float a, vec4 b){return vec4(1.0) -  (stp(vec4(a),b) * stp(b,vec4(a)));}\n    vec4 not(vec4 a){return vec4(0.0);}\n    float not(float a){return 0.0;}\n\n\n    // LRG\n    float lrg(float a, float b){return step(b, a);}\n    vec2 lrg(vec2 a, vec2 b){return step(b, a);}\n    vec3 lrg(vec3 a, vec3 b){return step(b, a);}\n    vec4 lrg(vec4 a, vec4 b){return step(b, a);}\n    vec4 lrg(vec4 a, float b){return step(vec4(b), a);}\n    float lrg(float a, vec4 b){return step(b.x, a);}\n\n\n    float sml(float a, float b){return step(a, b);}\n    vec2 sml(vec2 a, vec2 b){return step(a, b);}\n    vec3 sml(vec3 a, vec3 b){return step(a, b);}\n    vec4 sml(vec4 a, vec4 b){return step(a, b);}\n    vec4 sml(vec4 a, float b){return step(a, vec4(b));}\n    float sml(float a, vec4 b){return step(a, b.x);}\n\n\n    // MIN\n    vec4 mn(vec4 a, vec4 b){return min(a,b);}\n    float mn(float a, float b){return min(a,b);}\n    vec4 mn(float a, vec4 b){return min(vec4(a), b);}\n    vec4 mn(vec4 a, float b){return min(a, vec4(b));}\n    vec4 mn(vec4 a){return a;}\n    float mn(float a){return a;}\n\n    // MAX\n    vec2 mx(vec2 a, vec2 b){return max(a,b);}\n    vec3 mx(vec3 a, vec3 b){return max(a,b);}\n    vec4 mx(vec4 a, vec4 b){return max(a,b);}\n    float mx(float a, float b){return max(a,b);}\n    vec4 mx(float a, vec4 b){return max(vec4(a), b);}\n    vec4 mx(vec4 a, float b){return max(a, vec4(b));}\n    vec4 mx(vec4 a){return a;}\n    float mx(float a){return a;}\n\n\n\n\n    // UNARY //\n\n\n\n\n    // SQUARE ROOT\n    vec4 sqt(vec4 a){return sqrt(a);}\n    float sqt(float a){return sqrt(a);}\n    vec4 sqt(vec4 a, vec4 b){return sqrt(a);}\n    float sqt(float a, float b){return sqrt(a);}\n    float sqt(float a, vec4 b){return sqrt(a);}\n    vec4 sqt(vec4 a, float b){return sqrt(a);}\n\n    // NATURAL LOGARITHM\n    vec4 lg(vec4 a, vec4 b){return log(a);}\n    float lg(float a, float b){return log(a);}\n    float lg(float a){return log(a);}\n    vec4 lg(vec4 a){return log(a);}\n    float lg(float a, vec4 b){return log(a);}\n    vec4 lg(vec4 a, float b){return log(a);}\n\n    // SIGN\n    vec4 sgn(vec4 a){return sign(a);}\n    float sgn(float a){return sign(a);}\n    vec4 sgn(vec4 a, vec4 b){return sign(a);}\n    float sgn(float a, float b){return sign(a);}\n    float sgn(float a, vec4 b){return sign(a);}\n    vec4 sgn(vec4 a, float b){return sign(a);}\n\n    // ABSOLUTE VALUE\n    vec4 ab(vec4 a, vec4 b){return abs(a);}\n    float ab(float a, float b){return abs(a);}\n    float ab(float a, vec4 b){return abs(a);}\n    vec4 ab(vec4 a, float b){return abs(a);}\n\n\n    // FRACTIONAL PART\n    vec4 frc(vec4 a){return fract(a);}\n    float frc(float a){return fract(a);}\n    vec4 frc(vec4 a, vec4 b){return fract(a);}\n    float frc(float a, float b){return fract(a);}\n    float frc(float a, vec4 b){return fract(a);}\n    vec4 frc(vec4 a, float b){return fract(a);}\n\n\n    // FLOOR\n    vec4 flr(vec4 a){return floor(a);}\n    float flr(float a){return floor(a);}\n    vec4 flr(vec4 a, vec4 b){return floor(a);}\n    float flr(float a, float b){return floor(a);}\n    float flr(float a, vec4 b){return floor(a);}\n    vec4 flr(vec4 a, float b){return floor(a);}\n\n\n    // CEILING\n    vec4 cil(vec4 a){return ceil(a);}\n    float cil(float a){return ceil(a);}\n    vec4 cil(vec4 a, vec4 b){return ceil(a);}\n    float cil(float a, float b){return ceil(a);}\n    float cil(float a, vec4 b){return ceil(a);}\n    vec4 cil(vec4 a, float b){return ceil(a);}\n\n\n    // ROUNDING\n    vec4 rnd(vec4 a){return floor(a) + step(0.5,fract(a));}\n    float rnd(float a){return floor(a) + step(0.5,fract(a));}\n    vec4 rnd(vec4 a, vec4 b){return floor(a) + step(0.5,fract(a));}\n    float rnd(float a, float b){return floor(a) + step(0.5,fract(a));}\n    float rnd(float a, vec4 b){return floor(a) + step(0.5,fract(a));}\n    vec4 rnd(vec4 a, float b){return floor(a) + step(0.5,fract(a));}\n\n\n\n\n\n    // SINE\n    float sn(float a){return sin(a);}\n    vec2 sn(vec2 a){return sin(a);}\n    vec3 sn(vec3 a){return sin(a);}\n    vec4 sn(vec4 a){return sin(a);}\n    float sn(float a, vec4 b){return sin(a);}\n    vec4 sn(vec4 a, float b){return sin(a);}\n\n    // COSINE\n    float cs(float a){return cos(a);}\n    vec2 cs(vec2 a){return cos(a);}\n    vec3 cs(vec3 a){return cos(a);}\n    vec4 cs(vec4 a){return cos(a);}\n    float cs(float a, vec4 b){return cos(a);}\n    vec4 cs(vec4 a, float b){return cos(a);}\n\n    // TANGENT\n    vec4 tn(vec4 a, vec4 b){return tan(a);}\n    float tn(float a, float b){return tan(a);}\n    float tn(float a, vec4 b){return tan(a);}\n    vec4 tn(vec4 a, float b){return tan(a);}\n    vec4 tn(vec4 a){return tan(a);}\n    vec3 tn(vec3 a){return tan(a);}\n    vec2 tn(vec2 a){return tan(a);}\n    float tn(float a){return tan(a);}\n\n    // ARC SINE\n    vec4 asn(vec4 a, vec4 b){return asin(a);}\n    float asn(float a, float b){return asin(a);}\n    float asn(float a, vec4 b){return asin(a);}\n    vec4 asn(vec4 a, float b){return asin(a);}\n\n    // ARC COSINE\n    vec4 acs(vec4 a, vec4 b){return acos(a);}\n    float acs(float a, float b){return acos(a);}\n    float acs(float a, vec4 b){return acos(a);}\n    vec4 acs(vec4 a, float b){return acos(a);}\n\n    // ARC TANGENT\n    float atn(float a){return atan(a);}\n    vec2 atn(vec2 a){return atan(a);}\n    vec3 atn(vec3 a){return atan(a);}\n    vec4 atn(vec4 a){return atan(a);}\n\n    vec4 atn(vec4 a, vec4 b){return atan(a, b);}\n    float atn(float a, float b){return atan(a, b);}\n    float atn(float a, vec4 b){return atan(a, b.x);}\n    vec4 atn(vec4 a, float b){return atan(a, vec4(b));}\n    vec2 atn(vec2 a, float b){return atan(a, vec2(b));}\n    vec3 atn(vec3 a, float b){return atan(a, vec3(b));}\n\n\n    // OTHER //\n\n    //// DOT PRODUCT\n    float dt(float a, float b){return dot(a, b);}\n    float dt(vec2 a, vec2 b){return dot(a, b);}\n    float dt(vec3 a, vec3 b){return dot(a, b);}\n    float dt(float a, vec4 b){return dot(vec4(a), b);}\n    float dt(vec4 a, float b){return dot(a, vec4(b));}\n    float dt(vec4 a){return a.x + a.y + a.z + a.w;}\n    float dt(float a){return a;}\n\n    // NORMALIZE\n    vec4 nrm(vec4 a){return normalize(a);}\n    float nrm(float a){return normalize(a);}\n    vec4 nrm(vec4 a, vec4 b){return normalize(a);}\n    float nrm(float a, float b){return normalize(a);}\n    float nrm(float a, vec4 b){return normalize(a);}\n    vec4 nrm(vec4 a, float b){return normalize(a);}\n\n\n\n\n\n    const float PHI = 1.61803398874989484820459; // Φ = Golden Ratio\n\n    // RETURN A PSEUDO RANDOM NUMBER [0.0 - 1.0]\n    float rand(float _seed) {\n      vec2 st = gl_FragCoord.xy / resolution.xy;\n      return fract(sin(dot(st.xy, vec2(randSeed*12.9898,_seed*78.233)))* 43758.5453123);\n    }\n\n    // auto seed\n    float rand() {\n      vec2 st = gl_FragCoord.xy / resolution.xy;\n      return fract(sin(dot(st.xy, vec2(randSeed*12.9898,78.233)))* 43758.5453123);\n    }\n    // vec4\n    vec4 rand(float _seedA,float _seedB, float _seedC, float _seedD ) {\n      return vec4(rand(_seedA),rand(_seedB),rand(_seedC),rand(_seedD));\n    }\n    // vec4 with alpha 1\n    vec4 rand(float _seedA,float _seedB, float _seedC ) {\n      return vec4(rand(_seedA),rand(_seedB),rand(_seedC),1.0);\n    }\n\n    // 2D Random\n    float random_det(in vec2 st) {\n        return fract(sin(dot(st.xy,\n                             vec2(12.9898,78.233)))\n                     * 43758.5453123);\n    }\n\n\n\n\n    // from: https://www.shadertoy.com/view/MdsGDN\n    // noise\n    float noise(vec2 pos)\n    {\n    \treturn fract( sin( dot(pos*0.001 ,vec2(24.12357, 36.789) ) ) * 12345.123);\n    }\n    // blur noise\n    float smooth_noise(vec2 pos)\n    {\n    \treturn   ( noise(pos + vec2(1,1)) + noise(pos + vec2(1,1)) + noise(pos + vec2(1,1)) + noise(pos + vec2(1,1)) ) / 16.0\n    \t\t   + ( noise(pos + vec2(1,0)) + noise(pos + vec2(-1,0)) + noise(pos + vec2(0,1)) + noise(pos + vec2(0,-1)) ) / 8.0\n        \t   + noise(pos) / 4.0;\n    }\n    // linear interpolation\n    float interpolate_noise(vec2 pos)\n    {\n    \tfloat\ta, b, c, d;\n    \ta = smooth_noise(floor(pos));\n    \tb = smooth_noise(vec2(floor(pos.x+1.0), floor(pos.y)));\n    \tc = smooth_noise(vec2(floor(pos.x), floor(pos.y+1.0)));\n    \td = smooth_noise(vec2(floor(pos.x+1.0), floor(pos.y+1.0)));\n    \ta = mix(a, b, fract(pos.x));\n    \tb = mix(c, d, fract(pos.x));\n    \ta = mix(a, b, fract(pos.y));\n    \treturn a;\n    }\n    float perlin_noise(vec2 pos)\n    {\n    \tfloat\tn;\n\n    \tn = interpolate_noise(pos*0.0625)*0.5;\n    \tn += interpolate_noise(pos*0.125)*0.25;\n    \tn += interpolate_noise(pos*0.025)*0.225;\n    \tn += interpolate_noise(pos*0.05)*0.0625;\n    \tn += interpolate_noise(pos)*0.03125;\n    \treturn n;\n    }\n\n    float nois(vec2 p){\n      return perlin_noise(p*1000.0);\n    }\n    float nois(float x, float y){\n      return perlin_noise(vec2(x,y)*1000.0);\n    }\n\n\n    // GET A CELL VALUE (ABSOLUTE COORD)\n    vec4 get(float _x, float _y){\n      return texture2D( backbuffer, vec2(_x, _y) );\n    }\n    vec4 get(vec2 pos){\n      return texture2D( backbuffer, vec2(pos.x, pos.y) );\n    }\n\n\n    // TODO\n    vec4 set(float _x, float _y, vec4 c){\n      vec2 st = gl_FragCoord.xy / resolution.xy;\n      vec4 cell = vec4( st.x, st.y, max(1.0/resolution.x, 1.0/resolution.y), max(1.0/resolution.x, 1.0/resolution.y) );\n      return c * vec( stp(dst(vec2(0.5 + cell.w/2.0), cell.xy), cell.w/2.0 ));\n    }\n\n    vec4 set(float _x, float _y){\n      vec2 st = gl_FragCoord.xy / resolution.xy;\n      float rat = resolution.x / resolution.y;\n      vec4 cell = vec4( st.x, st.y, max(1.0/resolution.x, 1.0/resolution.y), max(1.0/resolution.x, 1.0/resolution.y) );\n\n      return vec( stp(dst(vec2(_x + cell.w/2.0, _y + cell.w/2.0), cell.xy), cell.w/2.0/rat ));\n    }\n\n    vec4 set(vec2 pos){\n      vec2 st = gl_FragCoord.xy / resolution.xy;\n      float rat = resolution.x / resolution.y;\n      vec4 cell = vec4( st.x, st.y, max(1.0/resolution.x, 1.0/resolution.y), max(1.0/resolution.x, 1.0/resolution.y) );\n\n      return vec( stp(dst(vec2(pos.x + cell.w/2.0, pos.y + cell.w/2.0), cell.xy), cell.w/2.0/rat ));\n    }\n\n\n    // GET A NEIGHBOUR RELATIVE TO SELF\n    vec4 U(float _x){\n      return texture2D(backbuffer, (gl_FragCoord.xy / resolution.xy) + ( (1.0/resolution.xy) * vec2(_x, 0.0)));\n    }\n    vec4 U(float _x, float _y){\n      vec2  uv = gl_FragCoord.xy / resolution.xy;\n      vec2 grid = vec2(resolution.x, resolution.y);\n      vec4 cell = vec4( uv.x, uv.y, max(1.0/grid.x, 1.0/grid.y), max(1.0/grid.x, 1.0/grid.y) );\n      float col = flr(cell.x*tiles.x)/tiles.x;\n      float row = flr(cell.y*tiles.y)/tiles.y;\n\n      vec4 res = get( col + mod(cell.x +_x*cell.w, 1.0/tiles.x)  , row + mod(cell.y + _y*cell.w, 1.0/tiles.y) );\n\n      // return texture2D(backbuffer, (gl_FragCoord.xy / resolution.xy) + ( (1.0/resolution.xy) * vec2(_x, _y)));\n      return res;\n    }\n    vec4 U(vec2 p){\n      return texture2D(backbuffer, (gl_FragCoord.xy / resolution.xy) + ( (1.0/resolution.xy) * vec2(p.x, p.y)));\n    }\n    vec4 U(vec3 p){\n      return texture2D(backbuffer, (gl_FragCoord.xy / resolution.xy) + ( (1.0/resolution.xy) * vec2(p.x, p.y)));\n    }\n    vec4 U(vec4 p){\n      return texture2D(backbuffer, (gl_FragCoord.xy / resolution.xy) + ( (1.0/resolution.xy) * vec2(p.x, p.y)));\n    }\n\n    float tile(float col, float _cols, float row, float _rows ){\n      vec2  uv = gl_FragCoord.xy / resolution.xy;\n      vec2 grid = vec2(resolution.x, resolution.y);\n      vec4 cell = vec4( uv.x, uv.y, max(1.0/grid.x, 1.0/grid.y), max(1.0/grid.x, 1.0/grid.y) );\n      return stp(col/_cols, cell.x) * stp( cell.x, (col+1.0)/_cols) * stp(row/_rows, cell.y) * stp( cell.y, (row+1.0)/_rows);\n    }\n\n    float tile(float col, float row ){\n      vec2  uv = gl_FragCoord.xy / resolution.xy;\n      vec2 grid = vec2(resolution.x, resolution.y);\n      vec4 cell = vec4( uv.x, uv.y, max(1.0/grid.x, 1.0/grid.y), max(1.0/grid.x, 1.0/grid.y) );\n      return stp(col/tiles.x, cell.x) * stp( cell.x, (col+1.0)/tiles.x) * stp(row/tiles.y, cell.y) * stp( cell.y, (row+1.0)/tiles.y);\n    }\n\n    ",e+=d.functions,e+="\n    void main()\n    {\n        // VARS\n        vec2  uv = gl_FragCoord.xy / resolution.xy;\n        vec2 grid = vec2(resolution.x, resolution.y);\n        vec4 cell = vec4( uv.x, uv.y, max(1.0/grid.x, 1.0/grid.y), max(1.0/grid.x, 1.0/grid.y) );\n        vec4 crsr = vec4(mouse.x , mouse.y, mouseDown, 0.0);\n        vec4 pcrsr = vec4(pmouse.x , pmouse.y, 0.0, 0.0);\n\n\n\n        // neighbourhood shortcuts\n        vec4 V =  U(0.,0.);\n        vec4 V1 =  U(0.,-1.);\n        vec4 V2 = U(0., 0.) + U(0.,-1.);\n        vec4 V3 = U(-1., -1.) + U(0., -1.) + U(1., -1.);\n        vec4 V4 = U(0., -1.) + U(0.,1.) + U(-1., 0.) + U(1.,0.);\n        vec4 V5 = V + V4;\n        vec4 V6 = V3 + U(-1., 1.) + U( 0., 1.) + U( 1., 1.);\n        vec4 V7 = V + V6;\n        vec4 V8 = V4 + U(-1., -1.) + U( 1., -1.) + U(-1., 1.) + U( 1., 1.);\n        vec4 V9 = V + V8;\n        vec4 V24 = V8 + U(-2., -2.) + U(-1., -2.) + U(0., -2.) + U(1., -2.) + U(2., -2.) + U(-2., -1.) + U(2., -1.) +  U(-2., 0.) + U(2., 0.) +  U(-2., 1.) + U(2., 1.) +  U(-2., 2.) + U(-1., 2.) + U(0., 2.) + U(1., 2.) + U(2., 2.);\n        vec4 V25 = V24 + V;\n        vec4  setup = "+d.config+";\n        vec4 update = V;\n    "}return void 0!==t&&(y=t),window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,n){window.setTimeout(e,1e3/60)}),function(){(a=document.createElement("canvas")).id=y,a.style.setProperty("image-rendering","pixelated"),a.style.setProperty("image-rendering","-moz-crisp-edges"),a.style.setProperty("image-rendering","crisp-edges"),a.style.setProperty("cursor","crosshair"),void 0===w?document.body.appendChild(a):w.appendChild(a);try{r=a.getContext("experimental-webgl",{preserveDrawingBuffer:!0})}catch(e){}if(!r)throw alert("WebGL not supported on this browser. Please use Chrome/Safari/Firefox"),new Error("cannot create webgl context");o=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,o),r.bufferData(r.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),r.STATIC_DRAW),I(),a.addEventListener("mousedown",(function(e){d.mouseDown=1;var n=a.getBoundingClientRect(),t=(e.clientX-n.left)/d.zoom,r=(e.clientY-n.top)/d.zoom;d.mouseX=t/d.width*d.mouseScl,d.mouseY=r/d.height*d.mouseScl}),!1),window.addEventListener("mouseup",(function(e){d.mouseDown=0}),!1),a.addEventListener("mouseover",(function(e){d.mouseOver=1}),!1),a.addEventListener("mouseout",(function(e){d.mouseOver=0}),!1),a.addEventListener("mousemove",(function(e){var n=a.getBoundingClientRect(),t=(e.clientX-n.left)/d.zoom,r=(e.clientY-n.top)/d.zoom;d.mouseX=t/d.width*d.mouseScl,d.mouseY=r/d.height*d.mouseScl}),!1),U(),function(){var e=r.createProgram(),n="\n    #ifdef GL_ES\n    precision highp float;\n    #endif\n    uniform vec2 resolution;\n    uniform sampler2D texture;\n    void main() {\n        vec2 uv = gl_FragCoord.xy / resolution.xy;\n        uv.y = 1.0 - uv.y;\n        gl_FragColor = texture2D( texture, uv );\n    }\n    ",t=P("\n    attribute vec3 position;\n    void main() {\n        gl_Position = vec4( position, 1.0 );\n    }\n    ",r.VERTEX_SHADER),a=P(n,r.FRAGMENT_SHADER);if(r.attachShader(e,t),r.attachShader(e,a),r.deleteShader(t),r.deleteShader(a),r.linkProgram(e),!r.getProgramParameter(e,r.LINK_STATUS))return void console.error("VALIDATE_STATUS: "+r.getProgramParameter(e,r.VALIDATE_STATUS),"ERROR: "+r.getError());i=e,A(e,"resolution"),A(e,"texture")}()}(),function e(){if(requestAnimationFrame(e),f=Date.now(),v=f-R,!0===x&&v>T){R=f-v%T;var n=(t=1/(v/1e3),a=0,r=Math.pow(10,a),Math.round(t*r)/r);d.avgFps=n,N(),-1!==d.stepLimit&&d.step>d.stepLimit&&(x=!1,d.completionCallback&&d.completionCallback())}var t,a,r;d.pMouseX=d.mouseX,d.pMouseY=d.mouseY}(),this.run=function(e){void 0!==e&&(d.transition=L(e)),d.startTime=Date.now(),x=!0,U()},this.step=function(){N()},this.stop=function(e){x=!1,void 0!==h&&(h.innerHTML="Paused")},this.setup=function(e){void 0!==e&&(d.config=L(e)),d.useInput?D():d.doConfig=1,d.step=0},this.update=function(e){d.transition=L(e)},this.setStepLimit=function(e,n=null){d.stepLimit=e,null!==n&&(d.completionCallback=n)},this.alpha=function(e){d.alpha="0"===e?"0.0":"1.0",U()},this.fps=function(e){d.fps=e,T=1e3/d.fps},this.setUniform=function(e,n){b[e]=n},this.setFunctions=function(e){d.functions=e},this.edge=function(e){d.edge="REPEAT"===e||"repeat"===e||"wrap"===e||"WRAP"===e?"REPEAT":"CLAMP_TO_EDGE",I()},this.width=function(e){d.width=parseInt(e),I()},this.height=function(e){d.height=parseInt(e),I()},this.cursorScl=function(e){d.mouseScl=e},this.size=function(e,n){d.width=parseInt(e),d.height=parseInt(n),I()},this.tiles=function(e,n){d.tileColumns=parseInt(e),d.tileRows=parseInt(n)},this.input=function(e){e instanceof HTMLImageElement?(C(e),d.useInput=!0):"string"==typeof e?((_=document.createElement("img")).classList.add("hidden"),_.src=e,C(_),d.useInput=!0):d.useInput=!1},this.zoom=function(e){d.zoom=Math.max(.01,e),d.zoom=Math.min(128,d.zoom),O()},this.seed=function(e){d.randSeed=e},this.getStatus=function(){return x?"running, current step: "+d.step:"paused, current step: "+d.step},this.getVars=function(){return b},this.getFps=function(){return d.avgFps},this.errors=function(){return m},this.getCursorX=function(){return d.mouseX},this.getCursorY=function(){return d.mouseY},this.getWidth=function(){return d.width},this.getHeight=function(){return d.height},this.getParams=function(){return d},this.getUpdate=function(){return d.transition},this.getSetup=function(){return d.config},this.setParent=function(e){(w=e).appendChild(a)},this.setCanvasId=function(e){y=e},this.getCanvasId=function(){return y},this.setExternalStepCounter=function(e){g=e},this.setExternalInfoText=function(e){h=e},this.saveImg=function(){M("download")},this.getImg=function(){return M("obj")},this}
